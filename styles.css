/* ===========================
   Root variables & base setup
   =========================== */
:root {
  color-scheme: light;

  /* Layout */
  --w-nav: 320px;        /* folders/files column */
  --text-size: 1.10rem;

  /* Typography */
  --font-body: system-ui, "Segoe UI", "Noto Sans Hebrew", "Rubik", Arial, sans-serif;
  --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;

  /* Colors (light) */
  --bg: #f7f9fc;
  --panel: #ffffff;
  --fg: #0f172a;
  --muted: #64748b;
  --accent: #0ea5e9;
  --border: #e5e7eb;

  --pill-bg: #f1f5f9;
  --pill-fg: #0f172a;
  --pill-bg-hover: #e2e8f0;
  --save-bg: #daf8c1;

  /* Diff colors (kept for future) */
  --ins-bg: rgba(16, 185, 129, .16);
  --del-bg: rgba(239, 68, 68, .15);
  --eq-bg: transparent;

  /* Transcript highlights */
  --active-bg: rgba(14, 165, 233, .18);

  /* Probability highlight (JS uses --prob-a per token) */
  --prob-color: 255, 235, 59; /* bright yellow */
  --prob-alpha: .6;

  /* Elevation */
  --shadow-1: 0 2px 6px rgba(0, 0, 0, .08);
  --shadow-2: 0 12px 28px rgba(0, 0, 0, .12);
}

/* Dark theme via <html class="theme-dark"> */
html.theme-dark {
  color-scheme: dark;
  --bg: #0b0f14;
  --fg: #f2f3f5;
  --panel: #0f141a;
  --border: #1f2733;
  --pill-bg: #111821;
  --pill-fg: #ffffff;
  --pill-bg-hover: #333333;
  --accent: #38bdf8;
  --save-bg: #003f05;
  --muted: #9aa3af;
}

/* Respect system light/dark defaults (can still override with theme-dark) */
@media (prefers-color-scheme: light) {
  :root {
    --bg: #f8f8fb;
    --panel: #ffffff;
    --muted: #6b7280;
    --fg: #0b1020;
    --accent: #2563eb;
    --border: #e5e7eb;
    --pill-bg: #f3f4f6;
    --pill-fg: #111827;
    --pill-bg-hover: #e5e7eb;

    --ins-bg: rgba(0, 160, 0, .14);
    --del-bg: rgba(255, 0, 0, .12);
    --active-bg: rgba(37, 99, 235, .18);
  }
}

/* ===========================
   Base & resets
   =========================== */
* { box-sizing: border-box; }
html, body {
  height: 100%;
  margin: 0;
  color: var(--fg);
  background: var(--bg);
}
html { scroll-behavior: smooth; }

/* Perf: avoid global transitions on every element (expensive during typing). */
body { font: 400 15px/1.5 var(--font-body); direction: rtl; }

/* A11y utility */
.visually-hidden {
  position: absolute !important;
  width: 1px !important; height: 1px !important;
  padding: 0 !important; margin: -1px !important;
  overflow: hidden !important;
  clip: rect(0 0 1px 1px) !important;
  clip-path: inset(50%) !important; border: 0 !important;
}

.hint { color: var(--muted); font-size: .92em; }
.err  { color: #ef4444; }

/* ===========================
   Buttons
   =========================== */
button {
  font: inherit; color: inherit;
  background: transparent;
  border: 1px solid var(--border);
  border-radius: 999px;
  padding: .35rem .7rem;
  cursor: pointer;
}
button:hover { background: var(--pill-bg-hover); }
button:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }
.pill { background: var(--pill-bg); color: var(--pill-fg); border: 1px solid var(--border); }
.save { background: var(--save-bg); }
#probToggle[aria-pressed] { pointer-events: auto; opacity: 1; cursor: pointer; }

/* ===========================
   Header / player cluster
   =========================== */
header { padding-inline: .2rem; margin-top: .2rem; }
#playerCard {
  display: flex; flex-direction: column;
  background: var(--panel); border: 1px solid var(--border);
  border-radius: .75rem; box-shadow: var(--shadow-1);
}
.card .head {
  position: sticky; top: 0; z-index: 2;
  background: inherit; border-bottom: 1px solid var(--border);
  padding: .2rem .75rem;
}
#playerCard .head {
  display: flex; flex-direction: row-reverse; align-items: center; gap: .5rem;
}
#playerCard .cluster { flex: 0 0 auto; display: inline-flex; align-items: center; gap: .4rem; }
#player {
  flex: 1 1 40%; min-inline-size: 240px; inline-size: 100%; block-size: 36px;
}

/* ===========================
   Status line
   =========================== */
#err { padding-inline: .75rem; min-height: 1.25rem; }

/* ===========================
   Main 2-column panel (nav | gutter | transcript)
   =========================== */
#panel {
  flex: 1 1 auto; min-height: 0; /* allow children to scroll */
  display: grid;
  grid-template-columns: var(--w-nav) 6px 1fr;
  gap: 0;
  padding-inline: .75rem;
  align-items: stretch;
}

.card {
  display: flex; flex-direction: column; min-height: 0;
  background: var(--panel); border: 1px solid var(--border);
  border-radius: .75rem; overflow: hidden; box-shadow: var(--shadow-1);
}
.card .body { padding: .5rem .6rem; overflow: auto; min-height: 0; }

/* Gutter */
.gutter {
  background: linear-gradient(to left,
    transparent, transparent 35%,
    var(--border) 30%, var(--border) 70%,
    transparent 65%);
  cursor: col-resize; user-select: none; outline: none;
}
.gutter:focus-visible { box-shadow: inset 0 0 0 2px var(--accent); }

/* ===========================
   Browser lists
   =========================== */
#browserCard .head h2,
#transcriptCard .head h2 {
  font-weight: 600; font-size: 1.25rem; line-height: 1.2;
  margin: 0;
}
#transcriptCard .head {
  display: flex; align-items: center; gap: .4rem; justify-content: space-between;
}
#transcriptCard .head .actions {
  display: flex; align-items: center; gap: .35rem; margin-inline-start: auto; flex-wrap: wrap;
}

#browserGrid {
  display: grid; grid-template-columns: 1fr 1fr; gap: .5rem; min-height: 0;
}
#browserGrid .list {
  border: 1px dashed var(--border); border-radius: .5rem;
  padding: .25rem; overflow: auto; min-height: 0;
}
#browserGrid .item {
  display: block; width: 100%; text-align: start;
  background: transparent; border: 1px solid transparent;
  border-radius: .5rem; padding: .35rem .5rem; margin-bottom: .25rem;
}
#browserGrid .item:hover { background: var(--pill-bg-hover); }
#browserGrid .item.active {
  border-color: var(--accent); background: rgba(62, 166, 255, .10);
}

/* ===========================
   Transcript
   =========================== */
#transcript {
  white-space: pre-wrap;
  font-size: var(--text-size);
  line-height: 1.5;
  word-break: break-word;
  unicode-bidi: isolate;
}
#transcript:focus { outline: none; box-shadow: none; }

/* Tokens */
#transcript .word {
  padding-inline: .02em;
  border-radius: .15rem;
  direction: inherit; unicode-bidi: normal;
  /* Perf: explicit no transition on hot path nodes */
  transition: none !important;
}
#transcript .word.active {
  background: var(--active-bg);
}

/* Active + confirmed */
#transcript .word.confirmed-active {
  outline: 2px solid #22c55e; outline-offset: 2px; border-radius: .2rem;
}

/* Probability highlight via --prob-a (set per word by JS) */
#transcript.prob-on .word {
  background-color: rgba(var(--prob-color), var(--prob-a, 0));
}
/* Active word overrides probability bg */
#transcript.prob-on .word.active { background: var(--active-bg); }

/* Confirmed ranges (when view wraps content in .confirmed) */
#transcript .confirmed {
  color: #138a36;
  background: transparent !important;
  box-shadow: none !important;
}

/* ===========================
   Diff viewer (kept for future; unused now)
   =========================== */
#diffBody {
  font-size: var(--text-size);
  font-family: inherit;
  line-height: 1.5;
  white-space: pre-wrap;
  word-break: break-word;
}
.diff-insert { background: var(--ins-bg); }
.diff-delete { background: var(--del-bg); text-decoration: line-through; }
.diff-equal  { background: var(--eq-bg); }

/* ===========================
   Modal
   =========================== */
#modal {
  position: fixed; inset: 0;
  background: rgba(0, 0, 0, .45);
  display: none; place-items: center; z-index: 50;
}
#modal.open { display: grid; }
#modal .modal-content {
  background: var(--panel); color: var(--fg);
  width: min(560px, 92vw);
  border-radius: .75rem; border: 1px solid var(--border);
  box-shadow: var(--shadow-2);
  display: grid; grid-template-rows: auto 1fr auto;
}
.modal-head, .modal-foot {
  padding: .8rem 1rem; border-bottom: 1px solid var(--border);
}
.modal-foot { border-top: 1px solid var(--border); border-bottom: 0; display: flex; gap: .5rem; justify-content: start; }
.modal-body { padding: 1rem; display: grid; gap: .6rem; }
.modal-body input {
  width: 100%; padding: .5rem .6rem; border-radius: .5rem;
  border: 1px solid var(--border); background: var(--pill-bg); color: inherit;
}

/* ===========================
   Scrollbar styling (optional)
   =========================== */
@media (pointer: fine) {
  .card .body::-webkit-scrollbar,
  #browserGrid .list::-webkit-scrollbar { width: 10px; height: 10px; }
  .card .body::-webkit-scrollbar-thumb,
  #browserGrid .list::-webkit-scrollbar-thumb {
    background: rgba(128, 128, 128, .35);
    border-radius: 999px; border: 2px solid transparent; background-clip: padding-box;
  }
  .card .body::-webkit-scrollbar-thumb:hover,
  #browserGrid .list::-webkit-scrollbar-thumb:hover { background: rgba(128, 128, 128, .55); }
}
.no-scrollbar { scrollbar-width: none; }
.no-scrollbar::-webkit-scrollbar { display: none; }

/* ===========================
   Responsive
   =========================== */
@media (max-width: 1100px) {
  :root { --w-nav: 280px; }
}
@media (max-width: 900px) {
  #panel { grid-template-columns: 1fr; gap: .75rem; }
  .gutter { display: none; }
}
