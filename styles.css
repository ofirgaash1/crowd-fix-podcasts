/* ===========================
   Root variables & base setup
   =========================== */
:root{
  /* Layout */
  --w-nav: 320px;     /* browser (folders/files) column width */
  --w-diff: 360px;    /* diff column width */

  /* Typography */
  --font-body: system-ui, "Segoe UI", "Noto Sans Hebrew", "Rubik", Arial, sans-serif;
  --text-size: 1.10rem;
  --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;

  /* Colors (light theme) */
  --bg: #0a0a0a;            /* page background */
  --panel: #121212;         /* card background */
  --muted: #878787;         /* secondary text */
  --fg: #efefef;            /* primary text */
  --accent: #3ea6ff;        /* focus/links */
  --border: #242424;        /* dividers */
  --pill-bg: #1c1c1c;
  --pill-fg: #efefef;
  --pill-bg-hover: #232323;

  /* Diff colors */
  --ins-bg: rgba(0, 180, 0, .14);
  --del-bg: rgba(255, 60, 60, .16);
  --eq-bg: transparent;

  /* Transcript word highlight */
  --active-bg: rgba(62, 166, 255, .20);

  /* Probability highlight (JS reads these) */
  --prob-color: 255, 235, 59;  /* bright yellow */
  --prob-alpha: .6;

  /* Elevation */
  --shadow-1: 0 2px 10px rgba(0,0,0,.28);
  --shadow-2: 0 8px 24px rgba(0,0,0,.35);
}

/* Respect system dark/light â€“ easy to retheme later */
@media (prefers-color-scheme: light){
  :root{
    --bg: #f8f8fb;
    --panel: #ffffff;
    --muted: #6b7280;
    --fg: #0b1020;
    --accent: #2563eb;
    --border: #e5e7eb;
    --pill-bg: #f3f4f6;
    --pill-fg: #111827;
    --pill-bg-hover: #e5e7eb;

    --ins-bg: rgba(0, 160, 0, .14);
    --del-bg: rgba(255, 0, 0, .12);
    --active-bg: rgba(37, 99, 235, .18);
  }
}

/* ===========================
   Base element resets
   =========================== */
* { box-sizing: border-box; }
html, body { height: 100%; }
html { scroll-behavior: smooth; }
body{
  margin: 0;
  font: 400 15px/1.5 var(--font-body);
  color: var(--fg);
  background: var(--bg);
  direction: rtl;
  display: flex;
  flex-direction: column; /* header on top, main grows */
}

/* Utilities */
.visually-hidden{
  position: absolute!important;
  width: 1px!important;
  height: 1px!important;
  padding: 0!important;
  margin: -1px!important;
  overflow: hidden!important;
  clip: rect(0 0 1px 1px)!important;
  clip-path: inset(50%)!important;
  border: 0!important;
}

.hint{ color: var(--muted); font-size: .92em; }
.err{ color: #ef4444; }

/* Buttons */
button{
  font: inherit;
  color: inherit;
  background: transparent;
  border: 1px solid var(--border);
  border-radius: 999px;
  padding: .35rem .7rem;
  cursor: pointer;
}
button:hover{ background: var(--pill-bg-hover); }
button:focus-visible{
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}
.pill{
  background: var(--pill-bg);
  color: var(--pill-fg);
  border: 1px solid var(--border);
}

/* ===========================
   Header / player cluster
   =========================== */
header { padding-inline: .75rem; }

#playerCard{
  display: flex;
  flex-direction: column;
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: .75rem;
  box-shadow: var(--shadow-1);
}

/* Sticky head pattern used across cards */
.card .head{
  position: sticky;
  top: 0;
  z-index: 2;
  background: inherit;
  border-bottom: 1px solid var(--border);
  padding: 0.2rem .75rem;
}

/* Player header uses a flex row in RTL.
   We reverse the row so DOM order (right cluster, audio, left cluster)
   naturally places controls on far right & left with audio in center. */
#playerCard .head{
  display: flex;
  flex-direction: row-reverse;
  align-items: center;
  gap: .5rem;
}

/* Clusters (right/left) do not stretch */
#playerCard .cluster{ flex: 0 0 auto; display: inline-flex; align-items: center; gap: .4rem; }

/* Center audio stretches but respects min size and shrinks if needed */
#player{
  flex: 1 1 40%;
  min-inline-size: 240px;
  inline-size: 100%;
  block-size: 36px;
}

/* ===========================
   Status line
   =========================== */
#err{
  padding-inline: .75rem;
  min-height: 1.25rem;
}

/* ===========================
   Main 3-column panel
   =========================== */
#panel{
  /* Fill remaining viewport height under header without magic pixels */
  flex: 1 1 auto;
  min-height: 0; /* allow children to scroll */
  display: grid;
  grid-template-columns: var(--w-nav) 6px 1fr 6px var(--w-diff);
  gap: 0;
  padding-inline: .75rem;
  align-items: stretch;
}

/* Cards share look */
.card{
  display: flex;
  flex-direction: column;
  min-height: 0; /* key to allow .body overflow */
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: .75rem;
  overflow: hidden; /* keep sticky head edges crisp */
  box-shadow: var(--shadow-1);
}

.card .body{
  padding: .5rem .6rem;
  overflow: auto; /* each card scrolls independently */
  min-height: 0;
}

/* Grid placement: DOM order already matches columns:
   [browser] [gutterR] [transcript] [gutterL] [diff] */

/* Gutters for resizing */
.gutter{
  background: linear-gradient(to left, transparent, transparent 40%, var(--border) 40%, var(--border) 60%, transparent 60%);
  cursor: col-resize;
  user-select: none;
  outline: none;
}
.gutter:focus-visible{
  box-shadow: inset 0 0 0 2px var(--accent);
}

/* ===========================
   Browser lists
   =========================== */
#browserGrid{
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: .5rem;
  min-height: 0;
}

#browserGrid .list{
  border: 1px dashed var(--border);
  border-radius: .5rem;
  padding: .25rem;
  overflow: auto; /* independent scroll */
  min-height: 0;
}

#browserGrid .item{
  display: block;
  width: 100%;
  text-align: start;
  background: transparent;
  border: 1px solid transparent;
  border-radius: .5rem;
  padding: .35rem .5rem;
    margin-bottom: 0.25rem;
}
#browserGrid .item:hover{ background: var(--pill-bg-hover); }
#browserGrid .item.active{
  border-color: var(--accent);
  background: rgba(62,166,255,.10);
}

/* ===========================
   Transcript
   =========================== */
#transcript{
  white-space: pre-wrap;
  font-size: var(--text-size);
  line-height: 1.5;
  word-break: break-word;
}

/* Tokens */
#transcript .word{
  padding-inline: .02em;
  border-radius: .15rem;
}
#transcript .word.active{
  background: var(--active-bg);
}

/* Confirmed ranges (JS wraps spans in edit preview) */
#transcript .confirmed,
#editBox .confirmed{
  background: rgba(34,197,94,.18);
  box-shadow: inset 0 0 0 1px rgba(34,197,94,.45);
  border-radius: .2rem;
}

/* ContentEditable styling for full edit mode */
#editBox{
  background: transparent;
  border: 1px dashed var(--border);
  border-radius: .5rem;
  caret-color: var(--accent);
}

/* ===========================
   Diff viewer
   =========================== */
#diffBody{
  font-size: var(--text-size);
  font-family: inherit;
  line-height: 1.5;
  white-space: pre-wrap;
  word-break: break-word;
}
.diff-insert{ background: var(--ins-bg); }
.diff-delete{ background: var(--del-bg); text-decoration: line-through; }
.diff-equal{ background: var(--eq-bg); }

/* ===========================
   Floating "back to top" button
   =========================== */
.fab{
  position: fixed;
  inset-inline-end: 1rem;  /* RTL-friendly: "end" side */
  inset-block-end: 1rem;
  z-index: 40;
  width: 42px;
  height: 42px;
  border-radius: 999px;
  display: none; /* JS toggles */
  background: var(--pill-bg);
  color: var(--pill-fg);
  border: 1px solid var(--border);
  box-shadow: var(--shadow-2);
}

/* ===========================
   Modal
   =========================== */
#modal[hidden]{ display: none; }
#modal{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.45);
  display: grid;
  place-items: center;
  z-index: 50;
}
#modal .modal-content{
  background: var(--panel);
  color: var(--fg);
  width: min(560px, 92vw);
  border-radius: .75rem;
  border: 1px solid var(--border);
  box-shadow: var(--shadow-2);
  display: grid;
  grid-template-rows: auto 1fr auto;
}
.modal-head, .modal-foot{
  padding: .8rem 1rem;
  border-bottom: 1px solid var(--border);
}
.modal-foot{ border-top: 1px solid var(--border); border-bottom: 0; display: flex; gap: .5rem; justify-content: start; }
.modal-body{ padding: 1rem; display: grid; gap: .6rem; }
.modal-body input{
  width: 100%;
  padding: .5rem .6rem;
  border-radius: .5rem;
  border: 1px solid var(--border);
  background: var(--pill-bg);
  color: inherit;
}

/* ===========================
   Scrollbar styling (optional)
   =========================== */
@media (pointer: fine){
  /* WebKit */
  .card .body::-webkit-scrollbar,
  #browserGrid .list::-webkit-scrollbar{
    width: 10px; height: 10px;
  }
  .card .body::-webkit-scrollbar-thumb,
  #browserGrid .list::-webkit-scrollbar-thumb{
    background: rgba(128,128,128,.35);
    border-radius: 999px;
    border: 2px solid transparent;
    background-clip: padding-box;
  }
  .card .body::-webkit-scrollbar-thumb:hover,
  #browserGrid .list::-webkit-scrollbar-thumb:hover{
    background: rgba(128,128,128,.55);
  }
}

/* If you ever want to hide scrollbars but keep scrollable behavior, add .no-scrollbar */
.no-scrollbar{
  scrollbar-width: none; /* Firefox */
}
.no-scrollbar::-webkit-scrollbar{ display: none; }

/* ===========================
   Responsive
   =========================== */
@media (max-width: 1100px){
  :root{
    --w-nav: 280px;
    --w-diff: 300px;
  }
}
@media (max-width: 900px){
  /* Stack columns vertically when narrow */
  #panel{
    grid-template-columns: 1fr;
    gap: .75rem;
  }
  .gutter{ display: none; }
}
